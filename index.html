<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Pixel Village RPG</title>
  <style>
    body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; }
    canvas { image-rendering: pixelated; }
  </style>
</head>
<body>
  <canvas id="game" width="512" height="512"></canvas>
  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const tileSize = 32;
    const mapCols = 16, mapRows = 16;

    // タイル種類: 0: 草地, 1: 道, 2: 建物
    const tileset = {
      0: '#66cc66',
      1: '#cccccc',
      2: '#8B4513',
    };

    // マップデータ
    const map = [
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,2,2,0,0,0,0,2,2,0,0,0,0],
      [0,0,0,0,2,2,0,0,0,0,2,2,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
      [0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
      [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    ];

    // 主人公
    const hero = { x: 8, y: 10 };
    // NPCリスト
    const npcs = [
      { x: 5, y: 5, dialog: 'こんにちは、元気？' },
      { x: 10, y: 5, dialog: '今日はいい天気だね！' }
    ];

    // 描画
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < mapRows; y++) {
        for (let x = 0; x < mapCols; x++) {
          ctx.fillStyle = tileset[map[y][x]];
          ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
        }
      }
      // NPC
      ctx.fillStyle = '#0000ff';
      npcs.forEach(npc => {
        ctx.fillRect(npc.x * tileSize, npc.y * tileSize, tileSize, tileSize);
      });
      // 主人公
      ctx.fillStyle = '#ff0000';
      ctx.fillRect(hero.x * tileSize, hero.y * tileSize, tileSize, tileSize);
    }

    // キー操作
    document.addEventListener('keydown', (e) => {
      let nx = hero.x, ny = hero.y;
      if (e.key === 'ArrowLeft') nx--;
      if (e.key === 'ArrowRight') nx++;
      if (e.key === 'ArrowUp') ny--;
      if (e.key === 'ArrowDown') ny++;
      if (map[ny] && map[ny][nx] !== 2) {
        hero.x = nx;
        hero.y = ny;
        draw();
      }
      // 会話
      if (e.key === ' ' || e.key === 'Enter') {
        npcs.forEach(npc => {
          const dx = Math.abs(npc.x - hero.x);
          const dy = Math.abs(npc.y - hero.y);
          if (dx + dy === 1) {
            alert(npc.dialog);
          }
        });
      }
    });

    // NPCのランダム移動
    setInterval(() => {
      npcs.forEach(npc => {
        const dirs = [ [1,0],[-1,0],[0,1],[0,-1] ];
        const [dx, dy] = dirs[Math.floor(Math.random() * dirs.length)];
        const nx = npc.x + dx, ny = npc.y + dy;
        if (map[ny] && map[ny][nx] !== 2 && (nx !== hero.x || ny !== hero.y)) {
          npc.x = nx;
          npc.y = ny;
        }
      });
      draw();
    }, 1000);

    // 初回描画
    draw();
  </script>
</body>
</html>
